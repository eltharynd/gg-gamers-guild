import{a as Ae}from"./chunk-TJQ5J5K7.js";import{A as _e,B,C as ve,D as xe,E as Ce,F as he,G as Ee,I as be,J as ye,K as Se,L as we,M as Te,N as Ie,O as Me,P as Fe,Q as Oe,R as Pe,S as Ve,T as ke,U as Ge,V as Ne,W as De,X as Be,f as L,g as re,i as $,j as oe,n as ae,o as le,p as me,q as pe,r as x,s as se,t as de,u as D,v as h,w as ce,x as ue,y as fe,z as ge}from"./chunk-4HMBGEPO.js";import{$b as N,Ab as C,Db as R,Eb as M,Hb as b,Hc as Z,Ic as ee,J as A,Jb as g,Jc as te,Kc as ne,Lc as ie,Nb as Q,Ob as U,Pb as Y,Qb as k,Rb as l,Sb as G,Tb as _,Vb as W,Wb as J,Xb as X,Ya as m,Za as V,_b as j,bc as u,cc as f,dc as K,ea as z,fa as O,g as F,ia as y,ja as S,nb as v,pa as H,pb as d,qa as P,yb as o,zb as a}from"./chunk-AGJLDZAF.js";var Re=(()=>{let r=class r{constructor(){this.timeCorrector=t=>{if(/^[0-2][0-9]$/.test(t.value))t.setValue(`${t.value}:00`);else if(/^[0-2][0-9][0-9][0-9]$/.test(t.value)){let i=t.value.toString();t.setValue(`${i.substring(0,2)}:${i.substring(2,4)}`)}},this.timeValidator=t=>{if(/^[0-2][0-9]\:[0-9][0-9]$/.test(t.value))return null;{let i={};return i.time=t.value,i}},this.arrayValidator=t=>t.value?.length===0?{emptyArray:t.value?.length}:null,this.futureDateValidator=t=>{let i=new Date(t.value),n=new Date;if(n.setHours(0,0,0,0),i.getTime()<n.getTime()){let p={};return p.notInFuture=t.value,p}else return null}}};r.\u0275fac=function(i){return new(i||r)},r.\u0275prov=H({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();var qe=["expansionPanel"];function ze(e,r){e&1&&(o(0,"div",21),l(1," Non ci sono ancora rounds in questo evento... "),a())}function He(e,r){e&1&&(o(0,"div",30),l(1," Non ci sono ancora tavoli in questo round... "),a())}function Qe(e,r){if(e&1){let s=M();o(0,"div",31),u(1,"toFormGroup"),o(2,"span",23),l(3),a(),o(4,"mat-form-field",3)(5,"mat-label"),l(6,"Posti max"),a(),C(7,"input",32),o(8,"mat-error"),l(9),u(10,"formControlError"),a()(),o(11,"div",24)(12,"mat-form-field",3)(13,"mat-label"),l(14,"Posti ideali"),a(),C(15,"input",33),o(16,"mat-error"),l(17),u(18,"formControlError"),a()(),o(19,"mat-form-field",3)(20,"mat-label"),l(21,"Posti minimi"),a(),C(22,"input",34),o(23,"mat-error"),l(24),u(25,"formControlError"),a()()(),o(26,"div",14)(27,"button",29),b("click",function(){let n=y(s).$implicit,p=g().$implicit,c=g();return S(c.removeTable(p,n))}),l(28," Elimina "),a()()()}if(e&2){let s=r.$implicit,t=r.index;d("formGroup",f(1,5,s)),m(3),_("Tavolo ",t+1,""),m(6),_(" ",f(10,7,s.get("maximumSeats"))," "),m(8),_(" ",f(18,9,s.get("optimalSeats"))," "),m(7),_(" ",f(25,11,s.get("minimumSeats"))," ")}}function Ue(e,r){if(e&1){let s=M();o(0,"div",22),u(1,"toFormGroup"),o(2,"span",23),l(3),a(),o(4,"div",24)(5,"mat-form-field",3)(6,"mat-label"),l(7,"Inizio"),a(),C(8,"input",25),o(9,"mat-error"),l(10),u(11,"formControlError"),a()(),o(12,"mat-form-field",3)(13,"mat-label"),l(14,"Fine"),a(),C(15,"input",26),o(16,"mat-error"),l(17),u(18,"formControlError"),a()()(),v(19,He,2,0,"div",27),u(20,"toFormArray"),v(21,Qe,29,13,"div",28),u(22,"toFormArray"),o(23,"div",14)(24,"button",29),b("click",function(){let n=y(s).$implicit,p=g();return S(p.removeRound(n))}),l(25," Elimina "),a(),o(26,"button",15),b("click",function(){let n=y(s).$implicit,p=g();return S(p.addTable(n))}),l(27," Aggiungi "),a()()()}if(e&2){let s=r.$implicit,t=r.index;d("formGroup",f(1,6,s)),m(3),_("",t+1,"\xB0 Round"),m(7),_(" ",f(11,8,s.get("start"))," "),m(7),_(" ",f(18,10,s.get("end"))," "),m(2),d("ngIf",f(20,12,s.get("tables")).value.length<1),m(2),d("ngForOf",f(22,14,s.get("tables")).controls)}}function Ye(e,r){e&1&&(o(0,"mat-card-title"),l(1," Eventi programmati "),a())}function We(e,r){e&1&&(o(0,"mat-card-title"),l(1," Nessun evento in programma "),a())}function Je(e,r){e&1&&(o(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi programmati "),a())}function Xe(e,r){e&1&&(o(0,"mat-card-subtitle"),l(1," Crea un nuovo evento dal pannello qui sopra per farlo "),a())}var Ke=e=>({event:e});function Ze(e,r){if(e&1&&(o(0,"mat-card",35),R(1,36),a()),e&2){let s=r.$implicit;g();let t=k(75);m(),d("ngTemplateOutlet",t)("ngTemplateOutletContext",N(2,Ke,s))}}function et(e,r){e&1&&(o(0,"mat-card-title"),l(1," Eventi passati "),a())}function tt(e,r){e&1&&(o(0,"mat-card-title"),l(1," Nessun evento passato registrato "),a())}function nt(e,r){e&1&&(o(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi passati "),a())}var it=e=>({event:e,past:!0});function rt(e,r){if(e&1&&(o(0,"mat-card"),R(1,36),a()),e&2){let s=r.$implicit;g();let t=k(75);m(),d("ngTemplateOutlet",t)("ngTemplateOutletContext",N(2,it,s))}}var ot=()=>({standalone:!0});function at(e,r){if(e&1){let s=M();o(0,"input",42),X("ngModelChange",function(i){y(s);let n=g().event,p=g();return J(p._selectedFiles[n._id.toString()],i)||(p._selectedFiles[n._id.toString()]=i),S(i)}),b("change",function(i){y(s);let n=g().event,p=g();return S(p.uploadPicture(i,n))}),a()}if(e&2){let s=g().event,t=g();W("ngModel",t._selectedFiles[s._id.toString()]),d("ngModelOptions",j(2,ot))}}function lt(e,r){if(e&1&&(o(0,"div",30)(1,"div"),l(2),a()()),e&2){let s=r.index;m(2),_("Table ",s+1,"")}}function mt(e,r){if(e&1&&(o(0,"div",21)(1,"div"),l(2),a(),v(3,lt,3,1,"div",43),a()),e&2){let s=r.$implicit,t=r.index;m(2),_("",t+1,"\xB0 Round"),m(),d("ngForOf",s.tables)}}function pt(e,r){if(e&1){let s=M();o(0,"button",44),b("click",function(){y(s);let i=g().event,n=g();return S(n.deleteEvent(i))}),l(1," Cancella Evento "),a()}if(e&2){let s=g(2);d("disabled",s.data.busy)}}var st=e=>({"background-image":e}),dt=()=>({});function ct(e,r){if(e&1&&(o(0,"mat-card-header")(1,"mat-card-title"),l(2),a(),o(3,"mat-card-subtitle"),l(4),u(5,"date"),a()(),o(6,"mat-card-content",35)(7,"div",37),v(8,at,1,3,"input",38),a(),o(9,"div",39),l(10),a(),v(11,mt,4,2,"div",40),a(),o(12,"mat-card-footer")(13,"div",14),v(14,pt,2,1,"button",41),a()()),e&2){let s=r.event,t=r.past,i=g();m(2),G(s.title),m(2),G(f(5,7,s.date)),m(3),d("ngStyle",s.picture?N(9,st,"url("+i.pictureURL+s.picture+")"):j(11,dt)),m(),d("ngIf",!t),m(2),G(s.description),m(),d("ngForOf",s.rounds),m(3),d("ngIf",!t)}}var je=(()=>{let r=class r{constructor(t,i,n){this.data=t,this.utils=i,this.auth=n,this.pictureURL=`${$.API_BASE_URL}uploads/`,this.formGroup=new D({title:new h("",[x.required,x.minLength(1)]),description:new h(`Venite a giocare con noi!

L'evento \xE8 aperto a tutt\u0259: giocator\u0259 navigat\u0259 ed espert\u0259 ma anche, e soprattutto, debuttanti desiderosi di imparare.`,[x.required,x.minLength(1)]),date:new h(new Date,[this.utils.futureDateValidator]),location:new h("Spazio L'ove",[x.required,x.minLength(1)]),address:new h("Via Luganetto 1, 6962 Viganello",[x.required,x.minLength(1)]),rounds:new B([],[this.utils.arrayValidator])}),this.createRound=()=>{let p=new h("",[x.required,this.utils.timeValidator]);p.valueChanges.pipe(A(1e3)).subscribe(()=>{this.utils.timeCorrector(p)});let c=new h("",[x.required,this.utils.timeValidator]);return c.valueChanges.pipe(A(1e3)).subscribe(()=>{this.utils.timeCorrector(c)}),new D({start:p,end:c,tables:new B([],this.utils.arrayValidator)})},this.createTable=()=>new D({minimumSeats:new h,optimalSeats:new h,maximumSeats:new h(null,[x.required,x.min(1)])}),this._selectedFiles={},this.today=new Date,this.today.setHours(0,0,0,0)}ngOnInit(){return F(this,null,function*(){let t=yield this.data.get("events");this.events=t.filter(i=>(console.log(new Date(i.date).getTime()),console.log(this.today.getTime()),console.log(new Date(i.date).getTime()>=this.today.getTime()),new Date(i.date).getTime()>=this.today.getTime())),this.past=t.filter(i=>(console.log(new Date(i.date).getTime()),console.log(this.today.getTime()),console.log(new Date(i.date).getTime()<this.today.getTime()),new Date(i.date).getTime()<this.today.getTime()))})}addRound(){let t=this.formGroup.get("rounds"),i=this.createRound();if(t.length>0){let n=t.value.at(-1);Object.keys(n).forEach(p=>{if(p==="tables"){let c=new B([],[this.utils.arrayValidator]);n[p].forEach(w=>{let E=this.createTable();Object.keys(w).forEach(T=>{E.get(T).setValue(w[T])}),c.push(E)}),i.setControl(p,c)}else i.get(p).setValue(n[p])})}t.push(i)}removeRound(t){let i=this.formGroup.get("rounds"),n=i.controls.findIndex(p=>p===t);n>=0&&i.removeAt(n)}addTable(t){let i=t.get("tables"),n=this.createTable();if(i.length>0){let p=i.value.at(-1);Object.keys(p).forEach(c=>{n.get(c).setValue(p[c])})}i.push(n)}removeTable(t,i){let n=t.get("tables"),p=n.controls.findIndex(c=>c===i);p>=0&&n.removeAt(p)}save(){return F(this,null,function*(){this.formGroup.valid&&this.data.post("events",this.formGroup.getRawValue()).then(t=>{this.events.unshift(t),this.formGroup.get("rounds").clear(),this.formGroup.reset(),this.expansionPanel.close()})})}deleteEvent(t){return F(this,null,function*(){this.data.delete(`events/${t._id}`).then(()=>{this.events.splice(this.events.indexOf(t),1),delete this._selectedFiles[t._id.toString()]})})}uploadPicture(t,i){return new Promise((n,p)=>{let c=t.target?.files[0]||t.files[0];if(!c)return;let w=new FormData;w.append("file",c,c.name),w.append("filename",c.name);let E=new XMLHttpRequest;E.open("POST",`${$.API_BASE_URL}events/${i._id}`);let T=this.auth.getAuthorizationHeader();for(let I of Object.keys(T))E.setRequestHeader(I,T[I]);E.onerror=I=>{console.error(I),p(I)},E.onloadend=()=>{i.picture=JSON.parse(E.response)._id,n(E.response)},E.send(w)})}};r.\u0275fac=function(i){return new(i||r)(V(Ae),V(Re),V(oe))},r.\u0275cmp=z({type:r,selectors:[["app-events"]],viewQuery:function(i,n){if(i&1&&Q(qe,5),i&2){let p;U(p=Y())&&(n.expansionPanel=p.first)}},decls:76,vars:35,consts:[[1,"medium"],["expansionPanel",""],[3,"formGroup"],["appearance","outline"],["matInput","","type","text","formControlName","title"],["matInput","","type","text","formControlName","description","rows","10"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matIconSuffix","",3,"for"],["picker",""],[1,"row","ratio25-75"],["matInput","","type","text","formControlName","location","placeholder","Spazio L'ove"],["matInput","","type","text","formControlName","address","placeholder","Via Luganetto 1, 6962 Viganello"],["class","round",4,"ngIf"],["class","round box-shadow",3,"formGroup",4,"ngFor","ngForOf"],[1,"row","end"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngIf"],["class","event",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["eventCard",""],[1,"round"],[1,"round","box-shadow",3,"formGroup"],[1,"title"],[1,"row"],["matInput","","type","text","formControlName","start","placeholder","12:00"],["matInput","","type","text","formControlName","end","placeholder","14:00"],["class","table",4,"ngIf"],["class","table",3,"formGroup",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",1,"remove",3,"click"],[1,"table"],[1,"table",3,"formGroup"],["matInput","","type","number","formControlName","maximumSeats"],["matInput","","type","number","formControlName","optimalSeats"],["matInput","","type","number","formControlName","minimumSeats"],[1,"event"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"uploader",3,"ngStyle"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],[1,"description"],["class","round",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",3,"disabled","click",4,"ngIf"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change"],["class","table",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",3,"disabled","click"]],template:function(i,n){if(i&1&&(o(0,"mat-accordion",0)(1,"mat-expansion-panel",null,1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),l(5," Crea un nuovo evento "),a()(),o(6,"form",2)(7,"strong"),l(8,"Descrizione:"),a(),o(9,"mat-form-field",3)(10,"mat-label"),l(11,"Titolo"),a(),C(12,"input",4),o(13,"mat-error"),l(14),u(15,"formControlError"),a()(),o(16,"mat-form-field",3)(17,"mat-label"),l(18,"Descrizione"),a(),C(19,"textarea",5),o(20,"mat-error"),l(21),u(22,"formControlError"),a()(),o(23,"mat-form-field",3)(24,"mat-label"),l(25,"Data"),a(),C(26,"input",6)(27,"mat-datepicker-toggle",7)(28,"mat-datepicker",null,8),o(30,"mat-hint"),l(31,"DD/MM/YYYY"),a(),o(32,"mat-error"),l(33),u(34,"formControlError"),a()(),o(35,"div",9)(36,"mat-form-field",3)(37,"mat-label"),l(38,"Luogo"),a(),C(39,"input",10),o(40,"mat-error"),l(41),u(42,"formControlError"),a()(),o(43,"mat-form-field",3)(44,"mat-label"),l(45,"Indirizzo"),a(),C(46,"input",11),o(47,"mat-error"),l(48),u(49,"formControlError"),a()()(),v(50,ze,2,0,"div",12),u(51,"toFormArray"),v(52,Ue,28,16,"div",13),u(53,"toFormArray"),o(54,"div",14)(55,"button",15),b("click",function(){return n.addRound()}),l(56," Aggiungi round "),a()(),o(57,"button",16),b("click",function(){return n.save()}),l(58," CREA "),a()()()(),o(59,"mat-card",0)(60,"mat-card-header"),v(61,Ye,2,0,"mat-card-title",17)(62,We,2,0,"mat-card-title",17)(63,Je,2,0,"mat-card-subtitle",17)(64,Xe,2,0,"mat-card-subtitle",17),a(),o(65,"mat-card-content"),v(66,Ze,2,4,"mat-card",18),a()(),o(67,"mat-card",0)(68,"mat-card-header"),v(69,et,2,0,"mat-card-title",17)(70,tt,2,0,"mat-card-title",17)(71,nt,2,0,"mat-card-subtitle",17),a(),o(72,"mat-card-content"),v(73,rt,2,4,"mat-card",19),a()(),v(74,ct,15,12,"ng-template",null,20,K)),i&2){let p=k(29);m(6),d("formGroup",n.formGroup),m(8),_(" ",f(15,21,n.formGroup.get("title"))," "),m(7),_(" ",f(22,23,n.formGroup.get("description"))," "),m(5),d("matDatepicker",p)("min",n.today),m(),d("for",p),m(6),_(" ",f(34,25,n.formGroup.get("date"))," "),m(8),_(" ",f(42,27,n.formGroup.get("location"))," "),m(7),_(" ",f(49,29,n.formGroup.get("address"))," "),m(2),d("ngIf",f(51,31,n.formGroup.get("rounds")).value.length<1),m(2),d("ngForOf",f(53,33,n.formGroup.get("rounds")).controls),m(5),d("disabled",n.data.busy||!n.formGroup.valid),m(4),d("ngIf",(n.events==null?null:n.events.length)>0),m(),d("ngIf",(n.events==null?null:n.events.length)===0),m(),d("ngIf",(n.events==null?null:n.events.length)>0),m(),d("ngIf",(n.events==null?null:n.events.length)===0),m(2),d("ngForOf",n.events),m(3),d("ngIf",(n.past==null?null:n.past.length)>0),m(),d("ngIf",(n.past==null?null:n.past.length)===0),m(),d("ngIf",(n.past==null?null:n.past.length)>0),m(2),d("ngForOf",n.past)}},dependencies:[Z,ee,ne,te,ue,pe,fe,se,de,ce,ve,xe,he,ye,be,Ee,Ce,Oe,Pe,Ve,De,ke,Ge,Ne,Me,Se,Te,we,Ie,Fe,ge,_e,ie,le,ae,me],styles:[".round[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#f7f7f7}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#dcdcdc}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.title[_ngcontent-%COMP%]{position:absolute;top:-.75rem;font-weight:700}.event[_ngcontent-%COMP%]{margin-bottom:2rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem;gap:.5rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{white-space:break-spaces;margin-bottom:1rem}.event[_ngcontent-%COMP%]   mat-card-footer[_ngcontent-%COMP%]{padding:1rem}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%]{position:relative;background-image:url(/assets/skeletons/event.png);background-position:center;background-size:cover;width:100%;aspect-ratio:1}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{opacity:0;position:absolute;inset:0}"],data:{animation:[re]}});let e=r;return e})();var ut=[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:je}],Le=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=O({type:r}),r.\u0275inj=P({imports:[L.forChild(ut),L]});let e=r;return e})();var jt=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=O({type:r}),r.\u0275inj=P({imports:[Be,Le]});let e=r;return e})();export{jt as AdminModule};
