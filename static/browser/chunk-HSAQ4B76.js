import{$ as Ae,A as _e,B as xe,C as Ce,D as he,E as Ee,F as be,M as ye,N as Se,O as we,P as Me,Q as Ie,R as Te,S as Oe,T as Fe,U as Pe,V as Ve,W as ke,X as Ne,Y as Ge,Z as De,_ as Be,aa as Re,g as L,h as re,i as oe,j as x,k as ae,l as le,m as D,n as C,o as me,p as pe,q as se,r as de,s as ce,t as B,v as $,w as ue,x as fe,y as ge,z as ve}from"./chunk-PNVQZRF3.js";import{$b as X,Cb as o,Db as a,Eb as h,Hb as R,Ib as T,L as A,Lb as b,Lc as Z,Mc as ee,Nb as g,Nc as te,Oc as ie,Pc as ne,Rb as Q,Sb as U,Tb as Y,Ub as k,Vb as l,Wb as N,Xb as v,Zb as W,_b as J,ab as p,bb as V,cc as j,dc as G,fc as u,g as O,gc as f,ha as z,hc as K,ia as F,la as y,ma as S,rb as _,sa as H,ta as P,tb as d}from"./chunk-LIXSXWRS.js";var je=(()=>{let n=class n{constructor(){this.timeCorrector=e=>{if(/^[0-2][0-9]$/.test(e.value))e.setValue(`${e.value}:00`);else if(/^[0-2][0-9][0-9][0-9]$/.test(e.value)){let r=e.value.toString();e.setValue(`${r.substring(0,2)}:${r.substring(2,4)}`)}},this.timeValidator=e=>{if(/^[0-2][0-9]\:[0-9][0-9]$/.test(e.value))return null;{let r={};return r.time=e.value,r}},this.arrayValidator=e=>e.value?.length===0?{emptyArray:e.value?.length}:null,this.futureDateValidator=e=>{let r=new Date(e.value),t=new Date;if(t.setHours(0,0,0,0),r.getTime()<t.getTime()){let m={};return m.notInFuture=e.value,m}else return null}}};n.\u0275fac=function(r){return new(r||n)},n.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var ze=["expansionPanel"];function He(i,n){i&1&&(o(0,"div",21),l(1," Non ci sono ancora rounds in questo evento... "),a())}function Qe(i,n){i&1&&(o(0,"div",30),l(1," Non ci sono ancora tavoli in questo round... "),a())}function Ue(i,n){if(i&1){let s=T();o(0,"div",31),u(1,"toFormGroup"),o(2,"span",23),l(3),a(),o(4,"mat-form-field",3)(5,"mat-label"),l(6,"Posti max"),a(),h(7,"input",32),o(8,"mat-error"),l(9),u(10,"formControlError"),a()(),o(11,"div",24)(12,"mat-form-field",3)(13,"mat-label"),l(14,"Posti ideali"),a(),h(15,"input",33),o(16,"mat-error"),l(17),u(18,"formControlError"),a()(),o(19,"mat-form-field",3)(20,"mat-label"),l(21,"Posti minimi"),a(),h(22,"input",34),o(23,"mat-error"),l(24),u(25,"formControlError"),a()()(),o(26,"div",35)(27,"mat-checkbox",36),l(28,"DM"),a()(),o(29,"div",14)(30,"button",29),b("click",function(){let t=y(s).$implicit,m=g().$implicit,c=g();return S(c.removeTable(m,t))}),l(31," Elimina "),a()()()}if(i&2){let s=n.$implicit,e=n.index;d("formGroup",f(1,5,s)),p(3),v("Tavolo ",e+1,""),p(6),v(" ",f(10,7,s.get("maximumSeats"))," "),p(8),v(" ",f(18,9,s.get("optimalSeats"))," "),p(7),v(" ",f(25,11,s.get("minimumSeats"))," ")}}function Ye(i,n){if(i&1){let s=T();o(0,"div",22),u(1,"toFormGroup"),o(2,"span",23),l(3),a(),o(4,"div",24)(5,"mat-form-field",3)(6,"mat-label"),l(7,"Inizio"),a(),h(8,"input",25),o(9,"mat-error"),l(10),u(11,"formControlError"),a()(),o(12,"mat-form-field",3)(13,"mat-label"),l(14,"Fine"),a(),h(15,"input",26),o(16,"mat-error"),l(17),u(18,"formControlError"),a()()(),_(19,Qe,2,0,"div",27),u(20,"toFormArray"),_(21,Ue,32,13,"div",28),u(22,"toFormArray"),o(23,"div",14)(24,"button",29),b("click",function(){let t=y(s).$implicit,m=g();return S(m.removeRound(t))}),l(25," Elimina "),a(),o(26,"button",15),b("click",function(){let t=y(s).$implicit,m=g();return S(m.addTable(t))}),l(27," Aggiungi "),a()()()}if(i&2){let s=n.$implicit,e=n.index;d("formGroup",f(1,6,s)),p(3),v("",e+1,"\xB0 Round"),p(7),v(" ",f(11,8,s.get("start"))," "),p(7),v(" ",f(18,10,s.get("end"))," "),p(2),d("ngIf",f(20,12,s.get("tables")).value.length<1),p(2),d("ngForOf",f(22,14,s.get("tables")).controls)}}function We(i,n){i&1&&(o(0,"mat-card-title"),l(1," Eventi programmati "),a())}function Je(i,n){i&1&&(o(0,"mat-card-title"),l(1," Nessun evento in programma "),a())}function Xe(i,n){i&1&&(o(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi programmati "),a())}function Ke(i,n){i&1&&(o(0,"mat-card-subtitle"),l(1," Crea un nuovo evento dal pannello qui sopra per farlo "),a())}var Ze=i=>({event:i});function et(i,n){if(i&1&&(o(0,"mat-card",37),R(1,38),a()),i&2){let s=n.$implicit;g();let e=k(75);p(),d("ngTemplateOutlet",e)("ngTemplateOutletContext",G(2,Ze,s))}}function tt(i,n){i&1&&(o(0,"mat-card-title"),l(1," Eventi passati "),a())}function it(i,n){i&1&&(o(0,"mat-card-title"),l(1," Nessun evento passato registrato "),a())}function nt(i,n){i&1&&(o(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi passati "),a())}var rt=i=>({event:i,past:!0});function ot(i,n){if(i&1&&(o(0,"mat-card"),R(1,38),a()),i&2){let s=n.$implicit;g();let e=k(75);p(),d("ngTemplateOutlet",e)("ngTemplateOutletContext",G(2,rt,s))}}var at=()=>({standalone:!0});function lt(i,n){if(i&1){let s=T();o(0,"input",44),X("ngModelChange",function(r){y(s);let t=g().event,m=g();return J(m._selectedFiles[t._id.toString()],r)||(m._selectedFiles[t._id.toString()]=r),S(r)}),b("change",function(r){y(s);let t=g().event,m=g();return S(m.uploadPicture(r,t))}),a()}if(i&2){let s=g().event,e=g();W("ngModel",e._selectedFiles[s._id.toString()]),d("ngModelOptions",j(2,at))}}function mt(i,n){if(i&1&&(o(0,"div",30)(1,"div"),l(2),a()()),i&2){let s=n.index;p(2),v("Table ",s+1,"")}}function pt(i,n){if(i&1&&(o(0,"div",21)(1,"div"),l(2),a(),_(3,mt,3,1,"div",45),a()),i&2){let s=n.$implicit,e=n.index;p(2),v("",e+1,"\xB0 Round"),p(),d("ngForOf",s.tables)}}var st=i=>({"background-image":i}),dt=()=>({});function ct(i,n){if(i&1){let s=T();o(0,"mat-card-header")(1,"mat-card-title"),l(2),a(),o(3,"mat-card-subtitle"),l(4),u(5,"date"),a()(),o(6,"mat-card-content",37)(7,"div",39),_(8,lt,1,3,"input",40),a(),o(9,"div",41),l(10),a(),_(11,pt,4,2,"div",42),a(),o(12,"mat-card-footer")(13,"div",14)(14,"button",43),b("click",function(){let t=y(s).event,m=g();return S(m.deleteEvent(t))}),l(15," Cancella Evento "),a()()()}if(i&2){let s=n.event,e=n.past,r=g();p(2),N(s.title),p(2),N(f(5,7,s.date)),p(3),d("ngStyle",s.picture?G(9,st,"url("+r.pictureURL+s.picture+")"):j(11,dt)),p(),d("ngIf",!e),p(2),N(s.description),p(),d("ngForOf",s.rounds),p(3),d("disabled",r.data.busy)}}var Le=(()=>{let n=class n{constructor(e,r,t){this.data=e,this.utils=r,this.auth=t,this.pictureURL=`${$.API_BASE_URL}uploads/`,this.formGroup=new D({title:new C("",[x.required,x.minLength(1)]),description:new C(`Venite a giocare con noi!

L'evento \xE8 aperto a tutt\u0259: giocator\u0259 navigat\u0259 ed espert\u0259 ma anche, e soprattutto, debuttanti desiderosi di imparare.`,[x.required,x.minLength(1)]),date:new C(new Date,[this.utils.futureDateValidator]),location:new C("Spazio L'ove",[x.required,x.minLength(1)]),address:new C("Via Luganetto 1, 6962 Viganello",[x.required,x.minLength(1)]),rounds:new B([],[this.utils.arrayValidator])}),this.createRound=()=>{let m=new C("",[x.required,this.utils.timeValidator]);m.valueChanges.pipe(A(1e3)).subscribe(()=>{this.utils.timeCorrector(m)});let c=new C("",[x.required,this.utils.timeValidator]);return c.valueChanges.pipe(A(1e3)).subscribe(()=>{this.utils.timeCorrector(c)}),new D({start:m,end:c,tables:new B([],this.utils.arrayValidator)})},this.createTable=()=>new D({minimumSeats:new C,optimalSeats:new C,maximumSeats:new C(null,[x.required,x.min(1)]),hasDM:new C(!1)}),this._selectedFiles={},this.today=new Date,this.today.setHours(0,0,0,0)}ngOnInit(){return O(this,null,function*(){let e=yield this.data.get("events");this.events=e.filter(r=>new Date(r.date).getTime()>=this.today.getTime()),this.past=e.filter(r=>new Date(r.date).getTime()<this.today.getTime())})}addRound(){let e=this.formGroup.get("rounds"),r=this.createRound();if(e.length>0){let t=e.value.at(-1);Object.keys(t).forEach(m=>{if(m==="tables"){let c=new B([],[this.utils.arrayValidator]);t[m].forEach(w=>{let E=this.createTable();Object.keys(w).forEach(M=>{E.get(M).setValue(w[M])}),c.push(E)}),r.setControl(m,c)}else r.get(m).setValue(t[m])})}e.push(r)}removeRound(e){let r=this.formGroup.get("rounds"),t=r.controls.findIndex(m=>m===e);t>=0&&r.removeAt(t)}addTable(e){let r=e.get("tables"),t=this.createTable();if(r.length>0){let m=r.value.at(-1);Object.keys(m).forEach(c=>{t.get(c).setValue(m[c])})}r.push(t)}removeTable(e,r){let t=e.get("tables"),m=t.controls.findIndex(c=>c===r);m>=0&&t.removeAt(m)}save(){return O(this,null,function*(){this.formGroup.valid&&this.data.post("events",this.formGroup.getRawValue()).then(e=>{this.events.unshift(e),this.formGroup.get("rounds").clear(),this.formGroup.reset(),this.expansionPanel.close()})})}deleteEvent(e){return O(this,null,function*(){this.data.delete(`events/${e._id}`).then(()=>{this.events.indexOf(e)>=0&&this.events.splice(this.events.indexOf(e),1),this.past.indexOf(e)>=0&&this.past.splice(this.past.indexOf(e),1),delete this._selectedFiles[e._id.toString()]})})}uploadPicture(e,r){return new Promise((t,m)=>{let c=e.target?.files[0]||e.files[0];if(!c)return;let w=new FormData;w.append("file",c,c.name),w.append("filename",c.name);let E=new XMLHttpRequest;E.open("POST",`${$.API_BASE_URL}events/${r._id}`);let M=this.auth.getAuthorizationHeader();for(let I of Object.keys(M))E.setRequestHeader(I,M[I]);E.onerror=I=>{console.error(I),m(I)},E.onloadend=()=>{r.picture=JSON.parse(E.response)._id,t(E.response)},E.send(w)})}};n.\u0275fac=function(r){return new(r||n)(V(fe),V(je),V(ue))},n.\u0275cmp=z({type:n,selectors:[["app-admin-events"]],viewQuery:function(r,t){if(r&1&&Q(ze,5),r&2){let m;U(m=Y())&&(t.expansionPanel=m.first)}},decls:76,vars:35,consts:[[1,"medium"],["expansionPanel",""],[3,"formGroup"],["appearance","outline"],["matInput","","type","text","formControlName","title"],["matInput","","type","text","formControlName","description","rows","10"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matIconSuffix","",3,"for"],["picker",""],[1,"row","ratio25-75"],["matInput","","type","text","formControlName","location","placeholder","Spazio L'ove"],["matInput","","type","text","formControlName","address","placeholder","Via Luganetto 1, 6962 Viganello"],["class","round",4,"ngIf"],["class","round box-shadow",3,"formGroup",4,"ngFor","ngForOf"],[1,"row","end"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngIf"],["class","event",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["eventCard",""],[1,"round"],[1,"round","box-shadow",3,"formGroup"],[1,"title"],[1,"row"],["matInput","","type","text","formControlName","start","placeholder","12:00"],["matInput","","type","text","formControlName","end","placeholder","14:00"],["class","table",4,"ngIf"],["class","table",3,"formGroup",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",1,"remove",3,"click"],[1,"table"],[1,"table",3,"formGroup"],["matInput","","type","number","formControlName","maximumSeats"],["matInput","","type","number","formControlName","optimalSeats"],["matInput","","type","number","formControlName","minimumSeats"],[1,"mat-form-field"],["matInput","","formControlName","hasDM"],[1,"event"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"uploader",3,"ngStyle"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],[1,"description"],["class","round",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",3,"disabled","click"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change"],["class","table",4,"ngFor","ngForOf"]],template:function(r,t){if(r&1&&(o(0,"mat-accordion",0)(1,"mat-expansion-panel",null,1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),l(5," Crea un nuovo evento "),a()(),o(6,"form",2)(7,"strong"),l(8,"Descrizione:"),a(),o(9,"mat-form-field",3)(10,"mat-label"),l(11,"Titolo"),a(),h(12,"input",4),o(13,"mat-error"),l(14),u(15,"formControlError"),a()(),o(16,"mat-form-field",3)(17,"mat-label"),l(18,"Descrizione"),a(),h(19,"textarea",5),o(20,"mat-error"),l(21),u(22,"formControlError"),a()(),o(23,"mat-form-field",3)(24,"mat-label"),l(25,"Data"),a(),h(26,"input",6)(27,"mat-datepicker-toggle",7)(28,"mat-datepicker",null,8),o(30,"mat-hint"),l(31,"DD/MM/YYYY"),a(),o(32,"mat-error"),l(33),u(34,"formControlError"),a()(),o(35,"div",9)(36,"mat-form-field",3)(37,"mat-label"),l(38,"Luogo"),a(),h(39,"input",10),o(40,"mat-error"),l(41),u(42,"formControlError"),a()(),o(43,"mat-form-field",3)(44,"mat-label"),l(45,"Indirizzo"),a(),h(46,"input",11),o(47,"mat-error"),l(48),u(49,"formControlError"),a()()(),_(50,He,2,0,"div",12),u(51,"toFormArray"),_(52,Ye,28,16,"div",13),u(53,"toFormArray"),o(54,"div",14)(55,"button",15),b("click",function(){return t.addRound()}),l(56," Aggiungi round "),a()(),o(57,"button",16),b("click",function(){return t.save()}),l(58," CREA "),a()()()(),o(59,"mat-card",0)(60,"mat-card-header"),_(61,We,2,0,"mat-card-title",17)(62,Je,2,0,"mat-card-title",17)(63,Xe,2,0,"mat-card-subtitle",17)(64,Ke,2,0,"mat-card-subtitle",17),a(),o(65,"mat-card-content"),_(66,et,2,4,"mat-card",18),a()(),o(67,"mat-card",0)(68,"mat-card-header"),_(69,tt,2,0,"mat-card-title",17)(70,it,2,0,"mat-card-title",17)(71,nt,2,0,"mat-card-subtitle",17),a(),o(72,"mat-card-content"),_(73,ot,2,4,"mat-card",19),a()(),_(74,ct,16,12,"ng-template",null,20,K)),r&2){let m=k(29);p(6),d("formGroup",t.formGroup),p(8),v(" ",f(15,21,t.formGroup.get("title"))," "),p(7),v(" ",f(22,23,t.formGroup.get("description"))," "),p(5),d("matDatepicker",m)("min",t.today),p(),d("for",m),p(6),v(" ",f(34,25,t.formGroup.get("date"))," "),p(8),v(" ",f(42,27,t.formGroup.get("location"))," "),p(7),v(" ",f(49,29,t.formGroup.get("address"))," "),p(2),d("ngIf",f(51,31,t.formGroup.get("rounds")).value.length<1),p(2),d("ngForOf",f(53,33,t.formGroup.get("rounds")).controls),p(5),d("disabled",t.data.busy||!t.formGroup.valid),p(4),d("ngIf",(t.events==null?null:t.events.length)>0),p(),d("ngIf",(t.events==null?null:t.events.length)===0),p(),d("ngIf",(t.events==null?null:t.events.length)>0),p(),d("ngIf",(t.events==null?null:t.events.length)===0),p(2),d("ngForOf",t.events),p(3),d("ngIf",(t.past==null?null:t.past.length)>0),p(),d("ngIf",(t.past==null?null:t.past.length)===0),p(),d("ngIf",(t.past==null?null:t.past.length)>0),p(2),d("ngForOf",t.past)}},dependencies:[Z,ee,ie,te,pe,oe,se,ae,le,me,ge,we,Ie,Fe,Oe,Te,Me,Pe,Ve,ke,Ne,Ae,Ge,De,Be,he,ve,xe,_e,Ce,Ee,de,ce,ne,be,ye,Se],styles:[".round[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#f7f7f7}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#dcdcdc}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.title[_ngcontent-%COMP%]{position:absolute;top:-.75rem;font-weight:700}.event[_ngcontent-%COMP%]{margin-bottom:2rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem;gap:.5rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{white-space:break-spaces;margin-bottom:1rem}.event[_ngcontent-%COMP%]   mat-card-footer[_ngcontent-%COMP%]{padding:1rem}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%]{position:relative;background-image:url(/assets/skeletons/event.png);background-position:center;background-size:cover;width:100%;aspect-ratio:1}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{opacity:0;position:absolute;inset:0}"],data:{animation:[re]}});let i=n;return i})();var ut=[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:Le}],$e=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=F({type:n}),n.\u0275inj=P({imports:[L.forChild(ut),L]});let i=n;return i})();var Lt=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=F({type:n}),n.\u0275inj=P({imports:[Re,$e]});let i=n;return i})();export{Lt as AdminModule};
