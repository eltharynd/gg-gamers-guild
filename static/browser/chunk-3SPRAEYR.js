import{a as De}from"./chunk-TJQ5J5K7.js";import{A as ue,B as D,C as fe,D as ge,E as ve,F as _e,G as xe,I as he,J as Ce,K as Ee,L as be,M as ye,N as Se,O as we,P as Ie,Q as Me,R as Te,S as Fe,T as Oe,U as Pe,V as Ve,W as ke,X as Ge,f as A,g as te,i as $,j as ie,n as ne,o as re,p as oe,q as ae,r as v,s as le,t as me,u as G,v as h,w as se,x as de,y as pe,z as ce}from"./chunk-4HMBGEPO.js";import{$b as J,Ab as _,Eb as V,Hb as b,Hc as X,Ic as K,J as N,Jb as E,Jc as Z,Lc as ee,Nb as q,Ob as z,Pb as H,Qb as Q,Rb as l,Sb as k,Tb as g,Vb as U,Wb as Y,Xb as W,Ya as s,Za as P,_b as B,bc as u,cc as f,ea as R,fa as F,g as T,ia as y,ja as S,nb as x,pa as j,pb as p,qa as O,yb as r,zb as o}from"./chunk-AGJLDZAF.js";var Ne=(()=>{let n=class n{constructor(){this.timeCorrector=e=>{if(/^[0-2][0-9]$/.test(e.value))e.setValue(`${e.value}:00`);else if(/^[0-2][0-9][0-9][0-9]$/.test(e.value)){let i=e.value.toString();e.setValue(`${i.substring(0,2)}:${i.substring(2,4)}`)}},this.timeValidator=e=>{if(/^[0-2][0-9]\:[0-9][0-9]$/.test(e.value))return null;{let i={};return i.time=e.value,i}},this.arrayValidator=e=>e.value?.length===0?{emptyArray:e.value?.length}:null,this.futureDateValidator=e=>{let i=new Date(e.value),t=new Date;if(t.setHours(0,0,0,0),i.getTime()<t.getTime()){let m={};return m.notInFuture=e.value,m}else return null}}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var Le=["expansionPanel"];function Re(a,n){a&1&&(r(0,"div",20),l(1," Non ci sono ancora rounds in questo evento... "),o())}function je(a,n){a&1&&(r(0,"div",29),l(1," Non ci sono ancora tavoli in questo round... "),o())}function qe(a,n){if(a&1){let d=V();r(0,"div",30),u(1,"toFormGroup"),r(2,"span",22),l(3),o(),r(4,"mat-form-field",3)(5,"mat-label"),l(6,"Posti max"),o(),_(7,"input",31),r(8,"mat-error"),l(9),u(10,"formControlError"),o()(),r(11,"div",23)(12,"mat-form-field",3)(13,"mat-label"),l(14,"Posti ideali"),o(),_(15,"input",32),r(16,"mat-error"),l(17),u(18,"formControlError"),o()(),r(19,"mat-form-field",3)(20,"mat-label"),l(21,"Posti minimi"),o(),_(22,"input",33),r(23,"mat-error"),l(24),u(25,"formControlError"),o()()(),r(26,"div",14)(27,"button",28),b("click",function(){let t=y(d).$implicit,m=E().$implicit,c=E();return S(c.removeTable(m,t))}),l(28," Elimina "),o()()()}if(a&2){let d=n.$implicit,e=n.index;p("formGroup",f(1,5,d)),s(3),g("Tavolo ",e+1,""),s(6),g(" ",f(10,7,d.get("maximumSeats"))," "),s(8),g(" ",f(18,9,d.get("optimalSeats"))," "),s(7),g(" ",f(25,11,d.get("minimumSeats"))," ")}}function ze(a,n){if(a&1){let d=V();r(0,"div",21),u(1,"toFormGroup"),r(2,"span",22),l(3),o(),r(4,"div",23)(5,"mat-form-field",3)(6,"mat-label"),l(7,"Inizio"),o(),_(8,"input",24),r(9,"mat-error"),l(10),u(11,"formControlError"),o()(),r(12,"mat-form-field",3)(13,"mat-label"),l(14,"Fine"),o(),_(15,"input",25),r(16,"mat-error"),l(17),u(18,"formControlError"),o()()(),x(19,je,2,0,"div",26),u(20,"toFormArray"),x(21,qe,29,13,"div",27),u(22,"toFormArray"),r(23,"div",14)(24,"button",28),b("click",function(){let t=y(d).$implicit,m=E();return S(m.removeRound(t))}),l(25," Elimina "),o(),r(26,"button",15),b("click",function(){let t=y(d).$implicit,m=E();return S(m.addTable(t))}),l(27," Aggiungi "),o()()()}if(a&2){let d=n.$implicit,e=n.index;p("formGroup",f(1,6,d)),s(3),g("",e+1,"\xB0 Round"),s(7),g(" ",f(11,8,d.get("start"))," "),s(7),g(" ",f(18,10,d.get("end"))," "),s(2),p("ngIf",f(20,12,d.get("tables")).value.length<1),s(2),p("ngForOf",f(22,14,d.get("tables")).controls)}}function He(a,n){a&1&&(r(0,"mat-card-title"),l(1," Eventi programmati "),o())}function Qe(a,n){a&1&&(r(0,"mat-card-title"),l(1," Nessun evento in programma "),o())}function Ue(a,n){a&1&&(r(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi programmati "),o())}function Ye(a,n){a&1&&(r(0,"mat-card-subtitle"),l(1," Crea un nuovo evento dal pannello qui sopra per farlo "),o())}function We(a,n){if(a&1&&(r(0,"div",29)(1,"div"),l(2),o()()),a&2){let d=n.index;s(2),g("Table ",d+1,"")}}function Je(a,n){if(a&1&&(r(0,"div",20)(1,"div"),l(2),o(),x(3,We,3,1,"div",40),o()),a&2){let d=n.$implicit,e=n.index;s(2),g("",e+1,"\xB0 Round"),s(),p("ngForOf",d.tables)}}var Xe=a=>({"background-image":a}),Ke=()=>({}),Ze=()=>({standalone:!0});function et(a,n){if(a&1){let d=V();r(0,"mat-card",34)(1,"mat-card-header")(2,"mat-card-title"),l(3),o(),r(4,"mat-card-subtitle"),l(5),u(6,"date"),o()(),r(7,"mat-card-content",34)(8,"div",35)(9,"input",36),W("ngModelChange",function(i){let m=y(d).$implicit,c=E();return Y(c._selectedFiles[m._id.toString()],i)||(c._selectedFiles[m._id.toString()]=i),S(i)}),b("change",function(i){let m=y(d).$implicit,c=E();return S(c.uploadPicture(i,m))}),o()(),r(10,"div",37),l(11),o(),x(12,Je,4,2,"div",38),o(),r(13,"mat-card-footer")(14,"div",14)(15,"button",39),b("click",function(){let t=y(d).$implicit,m=E();return S(m.deleteEvent(t))}),l(16," Cancella Evento "),o()()()()}if(a&2){let d=n.$implicit,e=E();s(3),k(d.title),s(2),k(f(6,8,d.date)),s(3),p("ngStyle",d.picture?J(10,Xe,"url("+e.pictureURL+d.picture+")"):B(12,Ke)),s(),U("ngModel",e._selectedFiles[d._id.toString()]),p("ngModelOptions",B(13,Ze)),s(2),k(d.description),s(),p("ngForOf",d.rounds),s(3),p("disabled",e.data.busy)}}function tt(a,n){a&1&&(r(0,"mat-card-title"),l(1," Eventi passati "),o())}function it(a,n){a&1&&(r(0,"mat-card-title"),l(1," Nessun evento passato registrato "),o())}function nt(a,n){a&1&&(r(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi passati "),o())}function rt(a,n){a&1&&_(0,"mat-card")}var Be=(()=>{let n=class n{constructor(e,i,t){this.data=e,this.utils=i,this.auth=t,this.pictureURL=`${$.API_BASE_URL}uploads/`,this.formGroup=new G({title:new h("",[v.required,v.minLength(1)]),description:new h(`Venite a giocare con noi!

L'evento \xE8 aperto a tutt\u0259: giocator\u0259 navigat\u0259 ed espert\u0259 ma anche, e soprattutto, debuttanti desiderosi di imparare.`,[v.required,v.minLength(1)]),date:new h(new Date,[this.utils.futureDateValidator]),location:new h("Spazio L'ove",[v.required,v.minLength(1)]),address:new h("Via Luganetto 1, 6962 Viganello",[v.required,v.minLength(1)]),rounds:new D([],[this.utils.arrayValidator])}),this.createRound=()=>{let m=new h("",[v.required,this.utils.timeValidator]);m.valueChanges.pipe(N(1e3)).subscribe(()=>{this.utils.timeCorrector(m)});let c=new h("",[v.required,this.utils.timeValidator]);return c.valueChanges.pipe(N(1e3)).subscribe(()=>{this.utils.timeCorrector(c)}),new G({start:m,end:c,tables:new D([],this.utils.arrayValidator)})},this.createTable=()=>new G({minimumSeats:new h,optimalSeats:new h,maximumSeats:new h(null,[v.required,v.min(1)])}),this._selectedFiles={},this.today=new Date,this.today.setHours(0,0,0,0)}ngOnInit(){return T(this,null,function*(){let e=yield this.data.get("events");this.events=e.filter(i=>(console.log(new Date(i.date).getTime()),console.log(this.today.getTime()),console.log(new Date(i.date).getTime()>=this.today.getTime()),new Date(i.date).getTime()>=this.today.getTime())),this.past=e.filter(i=>(console.log(new Date(i.date).getTime()),console.log(this.today.getTime()),console.log(new Date(i.date).getTime()<this.today.getTime()),new Date(i.date).getTime()<this.today.getTime()))})}addRound(){let e=this.formGroup.get("rounds"),i=this.createRound();if(e.length>0){let t=e.value.at(-1);Object.keys(t).forEach(m=>{if(m==="tables"){let c=new D([],[this.utils.arrayValidator]);t[m].forEach(w=>{let C=this.createTable();Object.keys(w).forEach(I=>{C.get(I).setValue(w[I])}),c.push(C)}),i.setControl(m,c)}else i.get(m).setValue(t[m])})}e.push(i)}removeRound(e){let i=this.formGroup.get("rounds"),t=i.controls.findIndex(m=>m===e);t>=0&&i.removeAt(t)}addTable(e){let i=e.get("tables"),t=this.createTable();if(i.length>0){let m=i.value.at(-1);Object.keys(m).forEach(c=>{t.get(c).setValue(m[c])})}i.push(t)}removeTable(e,i){let t=e.get("tables"),m=t.controls.findIndex(c=>c===i);m>=0&&t.removeAt(m)}save(){return T(this,null,function*(){this.formGroup.valid&&this.data.post("events",this.formGroup.getRawValue()).then(e=>{this.events.unshift(e),this.formGroup.get("rounds").clear(),this.formGroup.reset(),this.expansionPanel.close()})})}deleteEvent(e){return T(this,null,function*(){this.data.delete(`events/${e._id}`).then(()=>{this.events.splice(this.events.indexOf(e),1),delete this._selectedFiles[e._id.toString()]})})}uploadPicture(e,i){return new Promise((t,m)=>{let c=e.target?.files[0]||e.files[0];if(!c)return;let w=new FormData;w.append("file",c,c.name),w.append("filename",c.name);let C=new XMLHttpRequest;C.open("POST",`${$.API_BASE_URL}events/${i._id}`);let I=this.auth.getAuthorizationHeader();for(let M of Object.keys(I))C.setRequestHeader(M,I[M]);C.onerror=M=>{console.error(M),m(M)},C.onloadend=()=>{i.picture=JSON.parse(C.response)._id,t(C.response)},C.send(w)})}};n.\u0275fac=function(i){return new(i||n)(P(De),P(Ne),P(ie))},n.\u0275cmp=R({type:n,selectors:[["app-events"]],viewQuery:function(i,t){if(i&1&&q(Le,5),i&2){let m;z(m=H())&&(t.expansionPanel=m.first)}},decls:74,vars:35,consts:[[1,"medium"],["expansionPanel",""],[3,"formGroup"],["appearance","outline"],["matInput","","type","text","formControlName","title"],["matInput","","type","text","formControlName","description","rows","10"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matIconSuffix","",3,"for"],["picker",""],[1,"row","ratio25-75"],["matInput","","type","text","formControlName","location","placeholder","Spazio L'ove"],["matInput","","type","text","formControlName","address","placeholder","Via Luganetto 1, 6962 Viganello"],["class","round",4,"ngIf"],["class","round box-shadow",3,"formGroup",4,"ngFor","ngForOf"],[1,"row","end"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngIf"],["class","event",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"round"],[1,"round","box-shadow",3,"formGroup"],[1,"title"],[1,"row"],["matInput","","type","text","formControlName","start","placeholder","12:00"],["matInput","","type","text","formControlName","end","placeholder","14:00"],["class","table",4,"ngIf"],["class","table",3,"formGroup",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",1,"remove",3,"click"],[1,"table"],[1,"table",3,"formGroup"],["matInput","","type","number","formControlName","maximumSeats"],["matInput","","type","number","formControlName","optimalSeats"],["matInput","","type","number","formControlName","minimumSeats"],[1,"event"],[1,"uploader",3,"ngStyle"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change"],[1,"description"],["class","round",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",3,"disabled","click"],["class","table",4,"ngFor","ngForOf"]],template:function(i,t){if(i&1&&(r(0,"mat-accordion",0)(1,"mat-expansion-panel",null,1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),l(5," Crea un nuovo evento "),o()(),r(6,"form",2)(7,"strong"),l(8,"Descrizione:"),o(),r(9,"mat-form-field",3)(10,"mat-label"),l(11,"Titolo"),o(),_(12,"input",4),r(13,"mat-error"),l(14),u(15,"formControlError"),o()(),r(16,"mat-form-field",3)(17,"mat-label"),l(18,"Descrizione"),o(),_(19,"textarea",5),r(20,"mat-error"),l(21),u(22,"formControlError"),o()(),r(23,"mat-form-field",3)(24,"mat-label"),l(25,"Data"),o(),_(26,"input",6)(27,"mat-datepicker-toggle",7)(28,"mat-datepicker",null,8),r(30,"mat-hint"),l(31,"DD/MM/YYYY"),o(),r(32,"mat-error"),l(33),u(34,"formControlError"),o()(),r(35,"div",9)(36,"mat-form-field",3)(37,"mat-label"),l(38,"Luogo"),o(),_(39,"input",10),r(40,"mat-error"),l(41),u(42,"formControlError"),o()(),r(43,"mat-form-field",3)(44,"mat-label"),l(45,"Indirizzo"),o(),_(46,"input",11),r(47,"mat-error"),l(48),u(49,"formControlError"),o()()(),x(50,Re,2,0,"div",12),u(51,"toFormArray"),x(52,ze,28,16,"div",13),u(53,"toFormArray"),r(54,"div",14)(55,"button",15),b("click",function(){return t.addRound()}),l(56," Aggiungi round "),o()(),r(57,"button",16),b("click",function(){return t.save()}),l(58," CREA "),o()()()(),r(59,"mat-card",0)(60,"mat-card-header"),x(61,He,2,0,"mat-card-title",17)(62,Qe,2,0,"mat-card-title",17)(63,Ue,2,0,"mat-card-subtitle",17)(64,Ye,2,0,"mat-card-subtitle",17),o(),r(65,"mat-card-content"),x(66,et,17,14,"mat-card",18),o()(),r(67,"mat-card",0)(68,"mat-card-header"),x(69,tt,2,0,"mat-card-title",17)(70,it,2,0,"mat-card-title",17)(71,nt,2,0,"mat-card-subtitle",17),o(),r(72,"mat-card-content"),x(73,rt,1,0,"mat-card",19),o()()),i&2){let m=Q(29);s(6),p("formGroup",t.formGroup),s(8),g(" ",f(15,21,t.formGroup.get("title"))," "),s(7),g(" ",f(22,23,t.formGroup.get("description"))," "),s(5),p("matDatepicker",m)("min",t.today),s(),p("for",m),s(6),g(" ",f(34,25,t.formGroup.get("date"))," "),s(8),g(" ",f(42,27,t.formGroup.get("location"))," "),s(7),g(" ",f(49,29,t.formGroup.get("address"))," "),s(2),p("ngIf",f(51,31,t.formGroup.get("rounds")).value.length<1),s(2),p("ngForOf",f(53,33,t.formGroup.get("rounds")).controls),s(5),p("disabled",t.data.busy||!t.formGroup.valid),s(4),p("ngIf",(t.events==null?null:t.events.length)>0),s(),p("ngIf",(t.events==null?null:t.events.length)===0),s(),p("ngIf",(t.events==null?null:t.events.length)>0),s(),p("ngIf",(t.events==null?null:t.events.length)===0),s(2),p("ngForOf",t.events),s(3),p("ngIf",(t.past==null?null:t.past.length)>0),s(),p("ngIf",(t.past==null?null:t.past.length)===0),s(),p("ngIf",(t.past==null?null:t.past.length)>0),s(2),p("ngForOf",t.past)}},dependencies:[X,K,Z,de,ae,pe,le,me,se,fe,ge,_e,Ce,he,xe,ve,Me,Te,Fe,ke,Oe,Pe,Ve,we,Ee,ye,be,Se,Ie,ce,ue,ee,re,ne,oe],styles:[".round[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#f7f7f7}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#dcdcdc}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.title[_ngcontent-%COMP%]{position:absolute;top:-.75rem;font-weight:700}.event[_ngcontent-%COMP%]{margin-bottom:2rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem;gap:.5rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{white-space:break-spaces;margin-bottom:1rem}.event[_ngcontent-%COMP%]   mat-card-footer[_ngcontent-%COMP%]{padding:1rem}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%]{position:relative;background-image:url(/assets/skeletons/event.png);background-position:center;background-size:cover;width:100%;aspect-ratio:1}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{opacity:0;position:absolute;inset:0}"],data:{animation:[te]}});let a=n;return a})();var ot=[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:Be}],Ae=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=F({type:n}),n.\u0275inj=O({imports:[A.forChild(ot),A]});let a=n;return a})();var Vt=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=F({type:n}),n.\u0275inj=O({imports:[Ge,Ae]});let a=n;return a})();export{Vt as AdminModule};
