import{a as Ae}from"./chunk-LEDM2TAJ.js";import{A as fe,B as ge,C as ve,D as B,E as _e,F as xe,G as Ce,H as he,I as Ee,K as be,L as ye,M as Se,N as we,O as Te,P as Ie,Q as Me,R as Oe,S as Fe,T as Pe,U as Ve,V as ke,W as Ge,X as Ne,Y as De,_ as Be,h as L,i as re,k as $,l as oe,p as ae,q as le,r as me,s as se,t as x,u as pe,v as de,w as D,x as h,y as ce,z as ue}from"./chunk-UO6XULM2.js";import{$b as N,Ab as C,Db as R,Eb as M,Hb as b,Hc as Z,Ic as ee,J as A,Jb as g,Jc as te,Kc as ie,Lc as ne,Nb as Q,Ob as U,Pb as Y,Qb as k,Rb as l,Sb as G,Tb as v,Vb as W,Wb as J,Xb as X,Ya as s,Za as V,_b as j,bc as u,cc as f,dc as K,ea as z,fa as F,g as O,ia as y,ja as S,nb as _,pa as H,pb as d,qa as P,yb as o,zb as a}from"./chunk-AGJLDZAF.js";var Re=(()=>{let r=class r{constructor(){this.timeCorrector=e=>{if(/^[0-2][0-9]$/.test(e.value))e.setValue(`${e.value}:00`);else if(/^[0-2][0-9][0-9][0-9]$/.test(e.value)){let n=e.value.toString();e.setValue(`${n.substring(0,2)}:${n.substring(2,4)}`)}},this.timeValidator=e=>{if(/^[0-2][0-9]\:[0-9][0-9]$/.test(e.value))return null;{let n={};return n.time=e.value,n}},this.arrayValidator=e=>e.value?.length===0?{emptyArray:e.value?.length}:null,this.futureDateValidator=e=>{let n=new Date(e.value),t=new Date;if(t.setHours(0,0,0,0),n.getTime()<t.getTime()){let m={};return m.notInFuture=e.value,m}else return null}}};r.\u0275fac=function(n){return new(n||r)},r.\u0275prov=H({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var qe=["expansionPanel"];function ze(i,r){i&1&&(o(0,"div",21),l(1," Non ci sono ancora rounds in questo evento... "),a())}function He(i,r){i&1&&(o(0,"div",30),l(1," Non ci sono ancora tavoli in questo round... "),a())}function Qe(i,r){if(i&1){let p=M();o(0,"div",31),u(1,"toFormGroup"),o(2,"span",23),l(3),a(),o(4,"mat-form-field",3)(5,"mat-label"),l(6,"Posti max"),a(),C(7,"input",32),o(8,"mat-error"),l(9),u(10,"formControlError"),a()(),o(11,"div",24)(12,"mat-form-field",3)(13,"mat-label"),l(14,"Posti ideali"),a(),C(15,"input",33),o(16,"mat-error"),l(17),u(18,"formControlError"),a()(),o(19,"mat-form-field",3)(20,"mat-label"),l(21,"Posti minimi"),a(),C(22,"input",34),o(23,"mat-error"),l(24),u(25,"formControlError"),a()()(),o(26,"div",14)(27,"button",29),b("click",function(){let t=y(p).$implicit,m=g().$implicit,c=g();return S(c.removeTable(m,t))}),l(28," Elimina "),a()()()}if(i&2){let p=r.$implicit,e=r.index;d("formGroup",f(1,5,p)),s(3),v("Tavolo ",e+1,""),s(6),v(" ",f(10,7,p.get("maximumSeats"))," "),s(8),v(" ",f(18,9,p.get("optimalSeats"))," "),s(7),v(" ",f(25,11,p.get("minimumSeats"))," ")}}function Ue(i,r){if(i&1){let p=M();o(0,"div",22),u(1,"toFormGroup"),o(2,"span",23),l(3),a(),o(4,"div",24)(5,"mat-form-field",3)(6,"mat-label"),l(7,"Inizio"),a(),C(8,"input",25),o(9,"mat-error"),l(10),u(11,"formControlError"),a()(),o(12,"mat-form-field",3)(13,"mat-label"),l(14,"Fine"),a(),C(15,"input",26),o(16,"mat-error"),l(17),u(18,"formControlError"),a()()(),_(19,He,2,0,"div",27),u(20,"toFormArray"),_(21,Qe,29,13,"div",28),u(22,"toFormArray"),o(23,"div",14)(24,"button",29),b("click",function(){let t=y(p).$implicit,m=g();return S(m.removeRound(t))}),l(25," Elimina "),a(),o(26,"button",15),b("click",function(){let t=y(p).$implicit,m=g();return S(m.addTable(t))}),l(27," Aggiungi "),a()()()}if(i&2){let p=r.$implicit,e=r.index;d("formGroup",f(1,6,p)),s(3),v("",e+1,"\xB0 Round"),s(7),v(" ",f(11,8,p.get("start"))," "),s(7),v(" ",f(18,10,p.get("end"))," "),s(2),d("ngIf",f(20,12,p.get("tables")).value.length<1),s(2),d("ngForOf",f(22,14,p.get("tables")).controls)}}function Ye(i,r){i&1&&(o(0,"mat-card-title"),l(1," Eventi programmati "),a())}function We(i,r){i&1&&(o(0,"mat-card-title"),l(1," Nessun evento in programma "),a())}function Je(i,r){i&1&&(o(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi programmati "),a())}function Xe(i,r){i&1&&(o(0,"mat-card-subtitle"),l(1," Crea un nuovo evento dal pannello qui sopra per farlo "),a())}var Ke=i=>({event:i});function Ze(i,r){if(i&1&&(o(0,"mat-card",35),R(1,36),a()),i&2){let p=r.$implicit;g();let e=k(75);s(),d("ngTemplateOutlet",e)("ngTemplateOutletContext",N(2,Ke,p))}}function et(i,r){i&1&&(o(0,"mat-card-title"),l(1," Eventi passati "),a())}function tt(i,r){i&1&&(o(0,"mat-card-title"),l(1," Nessun evento passato registrato "),a())}function it(i,r){i&1&&(o(0,"mat-card-subtitle"),l(1," Qui sotto trovi gli eventi passati "),a())}var nt=i=>({event:i,past:!0});function rt(i,r){if(i&1&&(o(0,"mat-card"),R(1,36),a()),i&2){let p=r.$implicit;g();let e=k(75);s(),d("ngTemplateOutlet",e)("ngTemplateOutletContext",N(2,nt,p))}}var ot=()=>({standalone:!0});function at(i,r){if(i&1){let p=M();o(0,"input",42),X("ngModelChange",function(n){y(p);let t=g().event,m=g();return J(m._selectedFiles[t._id.toString()],n)||(m._selectedFiles[t._id.toString()]=n),S(n)}),b("change",function(n){y(p);let t=g().event,m=g();return S(m.uploadPicture(n,t))}),a()}if(i&2){let p=g().event,e=g();W("ngModel",e._selectedFiles[p._id.toString()]),d("ngModelOptions",j(2,ot))}}function lt(i,r){if(i&1&&(o(0,"div",30)(1,"div"),l(2),a()()),i&2){let p=r.index;s(2),v("Table ",p+1,"")}}function mt(i,r){if(i&1&&(o(0,"div",21)(1,"div"),l(2),a(),_(3,lt,3,1,"div",43),a()),i&2){let p=r.$implicit,e=r.index;s(2),v("",e+1,"\xB0 Round"),s(),d("ngForOf",p.tables)}}var st=i=>({"background-image":i}),pt=()=>({});function dt(i,r){if(i&1){let p=M();o(0,"mat-card-header")(1,"mat-card-title"),l(2),a(),o(3,"mat-card-subtitle"),l(4),u(5,"date"),a()(),o(6,"mat-card-content",35)(7,"div",37),_(8,at,1,3,"input",38),a(),o(9,"div",39),l(10),a(),_(11,mt,4,2,"div",40),a(),o(12,"mat-card-footer")(13,"div",14)(14,"button",41),b("click",function(){let t=y(p).event,m=g();return S(m.deleteEvent(t))}),l(15," Cancella Evento "),a()()()}if(i&2){let p=r.event,e=r.past,n=g();s(2),G(p.title),s(2),G(f(5,7,p.date)),s(3),d("ngStyle",p.picture?N(9,st,"url("+n.pictureURL+p.picture+")"):j(11,pt)),s(),d("ngIf",!e),s(2),G(p.description),s(),d("ngForOf",p.rounds),s(3),d("disabled",n.data.busy)}}var je=(()=>{let r=class r{constructor(e,n,t){this.data=e,this.utils=n,this.auth=t,this.pictureURL=`${$.API_BASE_URL}uploads/`,this.formGroup=new D({title:new h("",[x.required,x.minLength(1)]),description:new h(`Venite a giocare con noi!

L'evento \xE8 aperto a tutt\u0259: giocator\u0259 navigat\u0259 ed espert\u0259 ma anche, e soprattutto, debuttanti desiderosi di imparare.`,[x.required,x.minLength(1)]),date:new h(new Date,[this.utils.futureDateValidator]),location:new h("Spazio L'ove",[x.required,x.minLength(1)]),address:new h("Via Luganetto 1, 6962 Viganello",[x.required,x.minLength(1)]),rounds:new B([],[this.utils.arrayValidator])}),this.createRound=()=>{let m=new h("",[x.required,this.utils.timeValidator]);m.valueChanges.pipe(A(1e3)).subscribe(()=>{this.utils.timeCorrector(m)});let c=new h("",[x.required,this.utils.timeValidator]);return c.valueChanges.pipe(A(1e3)).subscribe(()=>{this.utils.timeCorrector(c)}),new D({start:m,end:c,tables:new B([],this.utils.arrayValidator)})},this.createTable=()=>new D({minimumSeats:new h,optimalSeats:new h,maximumSeats:new h(null,[x.required,x.min(1)])}),this._selectedFiles={},this.today=new Date,this.today.setHours(0,0,0,0)}ngOnInit(){return O(this,null,function*(){let e=yield this.data.get("events");this.events=e.filter(n=>(console.log(new Date(n.date).getTime()),console.log(this.today.getTime()),console.log(new Date(n.date).getTime()>=this.today.getTime()),new Date(n.date).getTime()>=this.today.getTime())),this.past=e.filter(n=>(console.log(new Date(n.date).getTime()),console.log(this.today.getTime()),console.log(new Date(n.date).getTime()<this.today.getTime()),new Date(n.date).getTime()<this.today.getTime()))})}addRound(){let e=this.formGroup.get("rounds"),n=this.createRound();if(e.length>0){let t=e.value.at(-1);Object.keys(t).forEach(m=>{if(m==="tables"){let c=new B([],[this.utils.arrayValidator]);t[m].forEach(w=>{let E=this.createTable();Object.keys(w).forEach(T=>{E.get(T).setValue(w[T])}),c.push(E)}),n.setControl(m,c)}else n.get(m).setValue(t[m])})}e.push(n)}removeRound(e){let n=this.formGroup.get("rounds"),t=n.controls.findIndex(m=>m===e);t>=0&&n.removeAt(t)}addTable(e){let n=e.get("tables"),t=this.createTable();if(n.length>0){let m=n.value.at(-1);Object.keys(m).forEach(c=>{t.get(c).setValue(m[c])})}n.push(t)}removeTable(e,n){let t=e.get("tables"),m=t.controls.findIndex(c=>c===n);m>=0&&t.removeAt(m)}save(){return O(this,null,function*(){this.formGroup.valid&&this.data.post("events",this.formGroup.getRawValue()).then(e=>{this.events.unshift(e),this.formGroup.get("rounds").clear(),this.formGroup.reset(),this.expansionPanel.close()})})}deleteEvent(e){return O(this,null,function*(){this.data.delete(`events/${e._id}`).then(()=>{this.events.indexOf(e)>=0&&this.events.splice(this.events.indexOf(e),1),this.past.indexOf(e)>=0&&this.past.splice(this.past.indexOf(e),1),delete this._selectedFiles[e._id.toString()]})})}uploadPicture(e,n){return new Promise((t,m)=>{let c=e.target?.files[0]||e.files[0];if(!c)return;let w=new FormData;w.append("file",c,c.name),w.append("filename",c.name);let E=new XMLHttpRequest;E.open("POST",`${$.API_BASE_URL}events/${n._id}`);let T=this.auth.getAuthorizationHeader();for(let I of Object.keys(T))E.setRequestHeader(I,T[I]);E.onerror=I=>{console.error(I),m(I)},E.onloadend=()=>{n.picture=JSON.parse(E.response)._id,t(E.response)},E.send(w)})}};r.\u0275fac=function(n){return new(n||r)(V(Ae),V(Re),V(oe))},r.\u0275cmp=z({type:r,selectors:[["app-admin-events"]],viewQuery:function(n,t){if(n&1&&Q(qe,5),n&2){let m;U(m=Y())&&(t.expansionPanel=m.first)}},decls:76,vars:35,consts:[[1,"medium"],["expansionPanel",""],[3,"formGroup"],["appearance","outline"],["matInput","","type","text","formControlName","title"],["matInput","","type","text","formControlName","description","rows","10"],["matInput","","formControlName","date",3,"matDatepicker","min"],["matIconSuffix","",3,"for"],["picker",""],[1,"row","ratio25-75"],["matInput","","type","text","formControlName","location","placeholder","Spazio L'ove"],["matInput","","type","text","formControlName","address","placeholder","Via Luganetto 1, 6962 Viganello"],["class","round",4,"ngIf"],["class","round box-shadow",3,"formGroup",4,"ngFor","ngForOf"],[1,"row","end"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngIf"],["class","event",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["eventCard",""],[1,"round"],[1,"round","box-shadow",3,"formGroup"],[1,"title"],[1,"row"],["matInput","","type","text","formControlName","start","placeholder","12:00"],["matInput","","type","text","formControlName","end","placeholder","14:00"],["class","table",4,"ngIf"],["class","table",3,"formGroup",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",1,"remove",3,"click"],[1,"table"],[1,"table",3,"formGroup"],["matInput","","type","number","formControlName","maximumSeats"],["matInput","","type","number","formControlName","optimalSeats"],["matInput","","type","number","formControlName","minimumSeats"],[1,"event"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"uploader",3,"ngStyle"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],[1,"description"],["class","round",4,"ngFor","ngForOf"],["mat-raised-button","","color","warn",3,"disabled","click"],["type","file","accept",".png,.jpg,.jpeg",3,"ngModel","ngModelOptions","ngModelChange","change"],["class","table",4,"ngFor","ngForOf"]],template:function(n,t){if(n&1&&(o(0,"mat-accordion",0)(1,"mat-expansion-panel",null,1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),l(5," Crea un nuovo evento "),a()(),o(6,"form",2)(7,"strong"),l(8,"Descrizione:"),a(),o(9,"mat-form-field",3)(10,"mat-label"),l(11,"Titolo"),a(),C(12,"input",4),o(13,"mat-error"),l(14),u(15,"formControlError"),a()(),o(16,"mat-form-field",3)(17,"mat-label"),l(18,"Descrizione"),a(),C(19,"textarea",5),o(20,"mat-error"),l(21),u(22,"formControlError"),a()(),o(23,"mat-form-field",3)(24,"mat-label"),l(25,"Data"),a(),C(26,"input",6)(27,"mat-datepicker-toggle",7)(28,"mat-datepicker",null,8),o(30,"mat-hint"),l(31,"DD/MM/YYYY"),a(),o(32,"mat-error"),l(33),u(34,"formControlError"),a()(),o(35,"div",9)(36,"mat-form-field",3)(37,"mat-label"),l(38,"Luogo"),a(),C(39,"input",10),o(40,"mat-error"),l(41),u(42,"formControlError"),a()(),o(43,"mat-form-field",3)(44,"mat-label"),l(45,"Indirizzo"),a(),C(46,"input",11),o(47,"mat-error"),l(48),u(49,"formControlError"),a()()(),_(50,ze,2,0,"div",12),u(51,"toFormArray"),_(52,Ue,28,16,"div",13),u(53,"toFormArray"),o(54,"div",14)(55,"button",15),b("click",function(){return t.addRound()}),l(56," Aggiungi round "),a()(),o(57,"button",16),b("click",function(){return t.save()}),l(58," CREA "),a()()()(),o(59,"mat-card",0)(60,"mat-card-header"),_(61,Ye,2,0,"mat-card-title",17)(62,We,2,0,"mat-card-title",17)(63,Je,2,0,"mat-card-subtitle",17)(64,Xe,2,0,"mat-card-subtitle",17),a(),o(65,"mat-card-content"),_(66,Ze,2,4,"mat-card",18),a()(),o(67,"mat-card",0)(68,"mat-card-header"),_(69,et,2,0,"mat-card-title",17)(70,tt,2,0,"mat-card-title",17)(71,it,2,0,"mat-card-subtitle",17),a(),o(72,"mat-card-content"),_(73,rt,2,4,"mat-card",19),a()(),_(74,dt,16,12,"ng-template",null,20,K)),n&2){let m=k(29);s(6),d("formGroup",t.formGroup),s(8),v(" ",f(15,21,t.formGroup.get("title"))," "),s(7),v(" ",f(22,23,t.formGroup.get("description"))," "),s(5),d("matDatepicker",m)("min",t.today),s(),d("for",m),s(6),v(" ",f(34,25,t.formGroup.get("date"))," "),s(8),v(" ",f(42,27,t.formGroup.get("location"))," "),s(7),v(" ",f(49,29,t.formGroup.get("address"))," "),s(2),d("ngIf",f(51,31,t.formGroup.get("rounds")).value.length<1),s(2),d("ngForOf",f(53,33,t.formGroup.get("rounds")).controls),s(5),d("disabled",t.data.busy||!t.formGroup.valid),s(4),d("ngIf",(t.events==null?null:t.events.length)>0),s(),d("ngIf",(t.events==null?null:t.events.length)===0),s(),d("ngIf",(t.events==null?null:t.events.length)>0),s(),d("ngIf",(t.events==null?null:t.events.length)===0),s(2),d("ngForOf",t.events),s(3),d("ngIf",(t.past==null?null:t.past.length)>0),s(),d("ngIf",(t.past==null?null:t.past.length)===0),s(),d("ngIf",(t.past==null?null:t.past.length)>0),s(2),d("ngForOf",t.past)}},dependencies:[Z,ee,ie,te,ue,se,fe,pe,de,ce,_e,xe,he,ye,be,Ee,Ce,Fe,Pe,Ve,De,ke,Ge,Ne,Me,Se,Te,we,Ie,Oe,ge,ve,ne,le,ae,me],styles:[".round[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#f7f7f7}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{position:relative;border-radius:1rem;display:flex;flex-direction:column;gap:1rem;margin:0 1rem;padding:2rem;background-color:#dcdcdc}@media only screen and (max-width: 600px){.round[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{margin:0;padding:1rem .8rem}}.title[_ngcontent-%COMP%]{position:absolute;top:-.75rem;font-weight:700}.event[_ngcontent-%COMP%]{margin-bottom:2rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem;gap:.5rem}.event[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{white-space:break-spaces;margin-bottom:1rem}.event[_ngcontent-%COMP%]   mat-card-footer[_ngcontent-%COMP%]{padding:1rem}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%]{position:relative;background-image:url(/assets/skeletons/event.png);background-position:center;background-size:cover;width:100%;aspect-ratio:1}.event[_ngcontent-%COMP%]   .uploader[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{opacity:0;position:absolute;inset:0}"],data:{animation:[re]}});let i=r;return i})();var ct=[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:je}],Le=(()=>{let r=class r{};r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=F({type:r}),r.\u0275inj=P({imports:[L.forChild(ct),L]});let i=r;return i})();var Rt=(()=>{let r=class r{};r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=F({type:r}),r.\u0275inj=P({imports:[Be,Le]});let i=r;return i})();export{Rt as AdminModule};
